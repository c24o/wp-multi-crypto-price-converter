(()=>{"use strict";const e=window.wp.element,t=window.React,r=window.wp.i18n,c=window.ReactJSXRuntime;function n(e){return e&&0!==e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e):"â€”"}function o({coins:e}){const[o,s]=(0,t.useState)({}),[a,i]=(0,t.useState)("usd"),[l,u]=(0,t.useState)(1),[p,d]=(0,t.useState)(!0),[m,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{const t=new AbortController,r=e.join(",");let c;const n=async()=>{try{const{prices:e,next_update:o}=await async function(e,t){try{const r=await fetch(`/wp-json/mcc/v1/prices?coins=${e}`,{signal:t});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();if(c.success&&c.data?.prices){const e={};return c.data.prices.forEach(t=>{e[t.symbol]=parseFloat(t.price_usd)}),{prices:e,next_update:c.data.next_update}}throw new Error(c.message||"Invalid API response")}catch(e){if(e instanceof Error&&"AbortError"===e.name)throw e;return console.error("Failed to fetch prices:",e),{prices:{},next_update:0}}}(r,t.signal);if(Object.keys(e).length>0?(s(e),h(!1)):h(!0),!t.signal.aborted){let e=6e4;if(o){const t=o-Date.now()/1e3;e=t>0?1e3*t:5e3}c=setTimeout(n,e)}}catch(e){e instanceof Error&&"AbortError"!==e.name&&h(!0)}finally{t.signal.aborted||d(!1)}};return n(),()=>{clearTimeout(c),t.abort()}},[e]);const x=e=>{if(""===l||0===l)return"";if(e===a)return l;if("usd"!==a&&!o[a])return"";if("usd"!==e&&!o[e])return"";const t="usd"===a?l:l*o[a];return r=e,(c="usd"===e?t:t/o[e])&&r?"usd"===r?c.toFixed(2):c.toFixed(8):"";var r,c},f=e=>{if("INPUT"===e.target.tagName)return;const t=e.currentTarget.querySelector("input");t&&t.focus()};return(0,c.jsx)("figure",{className:"wp-block-table is-style-stripes",children:(0,c.jsxs)("table",{children:[(0,c.jsxs)("thead",{children:[(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{scope:"col",className:"mcpc-converter-th-coin",children:(0,r.__)("Coin","multi-crypto-price-converter")}),(0,c.jsx)("th",{scope:"col",className:"mcpc-converter-th-price",children:(0,r.__)("Price (USD)","multi-crypto-price-converter")}),(0,c.jsx)("th",{scope:"col",className:"mcpc-converter-th-amount",children:(0,r.__)("Amount","multi-crypto-price-converter")})]}),(0,c.jsxs)("tr",{className:"mcpc-converter-row"+("usd"===a?" mcpc-row-active":""),onClick:f,children:[(0,c.jsx)("td",{children:(0,r.__)("USD","multi-crypto-price-converter")}),(0,c.jsx)("td",{children:n(1)}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{id:"mcpc-usd-amount",type:"number",className:"mcpc-amount-input","aria-label":(0,r.__)("Amount in USD","multi-crypto-price-converter"),value:x("usd"),onChange:e=>{i("usd"),u(""===e.target.value?"":parseFloat(e.target.value))},placeholder:"1.00",step:"0.01",min:"0"})})]})]}),(0,c.jsx)("tbody",{children:p?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:3,children:(0,r.__)("Loading prices...","multi-crypto-price-converter")})}):m?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:3,className:"mcpc-error",children:(0,r.__)("Error loading prices.","multi-crypto-price-converter")})}):e.map(e=>{const t=o[e],r=e===a,s=`mcpc-amount-${e}`;return(0,c.jsxs)("tr",{"data-coin":e,className:r?"mcpc-row-active mcpc-converter-row":"mcpc-converter-row",onClick:f,children:[(0,c.jsx)("td",{children:e.toUpperCase()}),(0,c.jsx)("td",{children:n(t)}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{id:s,type:"number","aria-label":`Amount in ${e.toUpperCase()}`,className:"mcpc-amount-input",value:x(e),onChange:t=>{i(e),u(""===t.target.value?"":parseFloat(t.target.value))},placeholder:"-",step:"0.00000001",min:"0"})})]},e)})})]})})}function s(){document.querySelectorAll(".wp-block-multi-crypto-price-converter-converter").forEach(t=>{const r=t.dataset.coins;if(!r)return;const n=r.split(",").map(e=>e.trim()).filter(Boolean);if(0===n.length)return;const s=t.querySelector(".mcpc-converter-container");s&&(0,e.createRoot)(s).render((0,c.jsx)(o,{coins:n}))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()})();